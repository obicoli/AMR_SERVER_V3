import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import{SmartRenderer}from"@fusioncharts/core/src/component-interface";import Canvas from"../../components/canvas";import Line from"../../components/dataset/line";import timeNavigatorAxisFactory from"../../factories/time-navigator-axis";import scrollbarFactory from"../../factories/scrollbar-factory";import brushFactory from"../../factories/time-navigator-brush-factory";import TimeConverter from"@fusioncharts/utils/src/time-converter";import{pluckNumber}from"@fusioncharts/core/src/lib";var DEFAULT_GRID_STYLE={stroke:"#F1F1F1","stroke-width":"1","stroke-opacity":"1"},timeNavCanvas=function timeNavCanvas(timeNav){var config=timeNav.config,styleDef=timeNav.getFromEnv("getStyleDef"),chartAttrs=timeNav.getFromEnv("chart-attrib"),xStyle=config.xConfigs[0].style?config.xConfigs[0].style:{},gridLineStyle=Object.assign({},DEFAULT_GRID_STYLE,styleDef(xStyle["grid-line"]));timeNav.attachChild(Canvas,"canvas").configure({xConfigs:config.xConfigs,yConfigs:config.yConfigs,plotConfigs:config.plotConfigs,tableMap:config.tableMap,enableGridLines:true,gridBandSupported:false,gridLineDirection:"vertical",enableMarkers:false,enableReferenceLine:false,enableReferenceZone:false,leftBorder:config.border.left,bottomBorder:config.border.bottom,topBorder:config.border.top,rightBorder:config.border.right,enableTimeMarkers:false,styleGridLines:0,includeLegend:0,enableMouseTracking:0,isContext:true,dataTable:config.dataTable,gridLineStyle:gridLineStyle,legendInteracted:config.legendInteracted,canvasStyle:styleDef(chartAttrs.style&&chartAttrs.style.canvas)})},extractScales=function extractScales(cfg){return cfg.scale};var TimeNavigator=function(_SmartRenderer){_inheritsLoose(TimeNavigator,_SmartRenderer);function TimeNavigator(){var _this;_this=_SmartRenderer.call(this)||this;_this._dimensions={};_this._translation={};_this._scrollbarConfig={};_this.registerFactory("timeNavigatorAxis",timeNavigatorAxisFactory);_this.registerFactory("scrollbar",scrollbarFactory);_this.registerFactory("brush",brushFactory);_this.registerFactory("canvas",timeNavCanvas);return _this}var _proto=TimeNavigator.prototype;_proto.__setDefaultConfig=function __setDefaultConfig(obj){if(obj===void 0){obj={}}_SmartRenderer.prototype.__setDefaultConfig.call(this,obj);var config=this.config;config.startX=0;config.startY=0;config.scrollbarHeight=18;config.scrollbarStart=-17.5;config.scrollbarButtonWidth=17;config.yScalePadding=20;config.formatter=TimeConverter.formatter("%b %d, %Y");config.border={left:1,right:1,top:1,bottom:0};config.labels={}};_proto.setContextScaleLimit=function setContextScaleLimit(){var timeNav=this;timeNav.config.contextScale.setDomain([].concat(timeNav.getFromEnv("chart").getContextLimit()))};_proto.setDimension=function setDimension(dim){var _this2=this;if(dim===void 0){dim={}}var timeNav=this,selfConfig=timeNav.config,canvas=timeNav.getChildren("canvas")[0],brush=timeNav.getChildren("brush")[0],border=selfConfig.border,labelSpace=brush.getLabelSpace();timeNav._dimensions.width=pluckNumber(dim.width,timeNav._dimensions.width);timeNav._dimensions.height=pluckNumber(dim.height,timeNav._dimensions.height);canvas.setDimension({left:selfConfig.startX,top:labelSpace,width:this._dimensions.width,height:Math.max(this._dimensions.height-labelSpace-selfConfig.scrollbarHeight,0)});timeNav.getChildren("timeAxis").forEach((function(axis){axis.setTranslation(0,labelSpace);axis.placeAxis()}));selfConfig.xConfigs.map(extractScales).forEach((function(scale){scale.setRange([border.left,_this2._dimensions.width-(border.left/2+border.right/2)])}));selfConfig.contextScale.setRange(selfConfig.xConfigs[0].scale.getRange());selfConfig.yConfigs.map(extractScales).forEach((function(scale){return scale.setRange([_this2._dimensions.height-selfConfig.scrollbarHeight-border.top-border.bottom,labelSpace])}))};_proto.getPosition=function getPosition(){return{x:this.config._translateX,y:this.config._translateY}};_proto.setChildDimension=function setChildDimension(){var timeNav=this,selfConfig=timeNav.config,brush=timeNav.getChildren("brush")[0],labelSpace=brush.getLabelSpace(),scrollbar=timeNav.getChildren("scrollbar")[0];brush.setMaxBrushDimensions({x:selfConfig.startX,y:labelSpace,width:this._dimensions.width,height:this._dimensions.height-labelSpace-selfConfig.scrollbarHeight});scrollbar.setDimension({x:selfConfig.scrollbarStart,y:this._dimensions.height-selfConfig.scrollbarHeight,height:selfConfig.scrollbarHeight,width:this._dimensions.width+2*selfConfig.scrollbarButtonWidth+1});timeNav.setScrollbarConfig("width",this._dimensions.width+2*selfConfig.scrollbarButtonWidth+1);scrollbar.config.scrollRatio=timeNav.getScrollRatio();timeNav.setScrollbarConfig("scrollRatio",scrollbar.config.scrollRatio);scrollbar.config.scrollPosition=timeNav.getScrollPosition();timeNav.setScrollbarConfig("scrollPosition",scrollbar.config.scrollPosition);timeNav.setScrollbarConfig("height",selfConfig.scrollbarHeight)};_proto.getDimension=function getDimension(){return this._dimensions};_proto.configureAttributes=function configureAttributes(obj){if(obj===void 0){obj={}}_SmartRenderer.prototype.configureAttributes.call(this,obj);var timeNav=this,timeNavConfig=timeNav.config;Object.assign(timeNavConfig,obj);timeNav.setContextScaleLimit();timeNav.addToEnv("timeNavigator",timeNav);timeNav.addToEnv("timeNavigatorConfig",timeNavConfig)};_proto.attachHandlers=function attachHandlers(){var timeNav=this,brush,leftLabel,rightLabel;timeNav.addEventListener("fc-mouseover",timeNav.mouseoverHandler||(timeNav.mouseoverHandler=function(){clearTimeout(timeNav.mouseoutTimer);brush=this.getChildren("brush")[0];leftLabel=brush.getChildren("leftLabel")[0];rightLabel=brush.getChildren("rightLabel")[0];if(!leftLabel.config.showLabel&&!rightLabel.config.showLabel){leftLabel.setData({showLabel:true},true);rightLabel.setData({showLabel:true},true)}}));timeNav.addEventListener("fc-mouseup",timeNav.mouseupHandler||(timeNav.mouseupHandler=function(){brush.config.pointerReleasedOnParent=true}));timeNav.addEventListener("fc-mouseout",timeNav.mouseoutHandler||(timeNav.mouseoutHandler=function(){if(!timeNav.config.labelsGettingDragged){timeNav.mouseoutTimer=setTimeout((function(){leftLabel.setData({showLabel:false},true);rightLabel.setData({showLabel:false},true)}),20)}}))};_proto.draw=function draw(){var timeNav=this;timeNav.addGraphicalElement({el:"group",container:{id:"tropo",label:"group",isParent:true},component:timeNav,label:"group",attr:{name:"timenav-tropo",transform:timeNav.config.translate},id:"tropo"});timeNav.addGraphicalElement({el:"group",container:{id:"strato",label:"group",isParent:true},component:timeNav,label:"group",attr:{name:"timenav-strato",transform:timeNav.config.translate},id:"strato"});timeNav.addGraphicalElement({el:"group",container:{id:"meso",label:"group",isParent:true},component:timeNav,label:"group",attr:{name:"timenav-meso",transform:timeNav.config.translate},id:"meso"});timeNav.addGraphicalElement({el:"group",container:{id:"thermo",label:"group",isParent:true},component:timeNav,label:"group",attr:{name:"timenav-thermo",transform:timeNav.config.translate},id:"thermo"});timeNav.addGraphicalElement({el:"group",container:{id:"exo",label:"group",isParent:true},component:timeNav,label:"group",attr:{name:"timenav-exo",transform:timeNav.config.translate},id:"exo"});timeNav.addGraphicalElement({el:"group",attr:{name:"time-axis-group"},id:"axisTopGroup",label:"group",container:{id:"strato",label:"group"},component:timeNav},true);timeNav.addGraphicalElement({el:"group",attr:{name:"scrollbar-group"},id:"scrollbarContainer",label:"scrollbar",container:{id:"thermo",label:"group"},component:timeNav},true);timeNav.setChildDimension()};_proto.setScrollbarConfig=function setScrollbarConfig(conf,value){this._scrollbarConfig[conf]=value};_proto.getScrollbarConfig=function getScrollbarConfig(conf){return conf?this._scrollbarConfig[conf]:this._scrollbarConfig};_proto.validateDomain=function validateDomain(values){var timeNav=this,chart=timeNav.getFromEnv("chart"),scale=timeNav.config.contextScale,startDomainValue=scale.getDomainValue(values[0]),endDomainValue=scale.getDomainValue(values[1]);chart.setFocusLimit([startDomainValue,endDomainValue])};_proto.getScrollRatio=function getScrollRatio(){var timeNav=this,scrollbarConf=timeNav.getChildren("scrollbar")[0].config,width=scrollbarConf.width,height=scrollbarConf.height,scrollButtonsTotalWidth=2*Math.min(height,width*.5),brush=timeNav.getChildren("brush")[0],selectionWidth=brush.getCurrentBrushDimensions().width;return(selectionWidth+1)/Math.max(.001,width-scrollButtonsTotalWidth)};_proto.getScrollPosition=function getScrollPosition(){var timeNav=this,scrollbarConf=timeNav.getChildren("scrollbar")[0].config,width=scrollbarConf.width,height=scrollbarConf.height,scrollButtonsTotalWidth=2*Math.min(height,width*.5),brush=timeNav.getChildren("brush")[0],selectionStart=brush.getCurrentBrushDimensions().x,selectionWidth=brush.getCurrentBrushDimensions().width,scrollRatio=timeNav.getScrollbarConfig("scrollRatio"),anchorWidth=scrollRatio*(width-scrollButtonsTotalWidth),scrollPositionRange=width-(scrollButtonsTotalWidth+anchorWidth),rangeMinPx=scrollButtonsTotalWidth/2+anchorWidth/2-timeNav.config.scrollbarButtonWidth;return(selectionStart+selectionWidth/2-rangeMinPx)/scrollPositionRange};_proto.getDSdef=function getDSdef(){return Line};_proto.getName=function getName(){return"TimeNavigator"};return TimeNavigator}(SmartRenderer);export default TimeNavigator;