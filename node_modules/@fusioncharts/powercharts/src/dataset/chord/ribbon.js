import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import{SmartRenderer}from"@fusioncharts/core/src/component-interface";import{deg2Rad,polarToCartesian}from"@fusioncharts/utils/src/scale-utils/polar-util.js";import{toRaphaelColor,isIpad,BLANKSTRING,toPrecision}from"@fusioncharts/core/src/lib";import{M,A,C,HALF_PI,PI,PI2,SMALLSQUARE,MEDIUMSQUARE}from"../../chart/chord/utils";var normalizeAngles=function normalizeAngles(radians){return radians-HALF_PI},ribbonGenerator=function ribbonGenerator(points,radius,startAngle){var corners=points.map((function(p,i){var angle=deg2Rad(p),_polarToCartesian=polarToCartesian(radius,normalizeAngles(deg2Rad(startAngle))+angle),x=_polarToCartesian.x,y=_polarToCartesian.y,curveFactor=.6,distance=Math.abs(deg2Rad(points[3-i])-angle),nextPointDist=Math.abs(deg2Rad(points[(i+1)%4])-angle);if(distance>PI){distance=PI2-distance}if(distance*radius<radius){curveFactor*=distance}x=toPrecision(x,4);y=toPrecision(y,4);return{x:x,y:y,cpX:(1-curveFactor)*x,cpY:(1-curveFactor)*y,arc:nextPointDist}}));return[M,corners[0].x,corners[0].y,A,radius,radius,0,corners[0].arc>PI?1:0,1,corners[1].x,corners[1].y,C,corners[1].cpX,corners[1].cpY,corners[2].cpX,corners[2].cpY,corners[2].x,corners[2].y,A,radius,radius,0,corners[2].arc>PI?1:0,1,corners[3].x,corners[3].y,C,corners[3].cpX,corners[3].cpY,corners[0].cpX,corners[0].cpY,corners[0].x,corners[0].y].join(" ")},mouseOverFn=function mouseOverFn(){this.getLinkedParent().linkHoverIn(this.config.key)},mouseOutFn=function mouseOutFn(){this.getLinkedParent().linkHoverOut(this.config.key)},getTooltext=function getTooltext(config,basefontsize){var uniChar=isIpad?SMALLSQUARE:MEDIUMSQUARE,key,body=BLANKSTRING;for(key in config.tooltip){if(config.tooltip.hasOwnProperty(key)){body+="\n          <span style='color: "+config.tooltip[key].color+";'>\n            "+uniChar+"\n          </span>\n          "+(key+config.toolTipSepChar)+"\n          "+(config.showLinkValueOnHover?" &nbsp;":"")+"\n          "+(config.showLinkValueOnHover?config.tooltip[key].value:"")+"\n        <br>"}}return"<div style='padding: 2px; vertical-align: middle; font-size: "+basefontsize+"px;'>\n        "+body+"\n      </div>"};var Ribbon=function(_SmartRenderer){_inheritsLoose(Ribbon,_SmartRenderer);function Ribbon(id){var _this;_this=_SmartRenderer.call(this,id)||this;_this.addEventListener("fc-mouseover",mouseOverFn);_this.addEventListener("fc-mouseout",mouseOutFn);return _this}var _proto=Ribbon.prototype;_proto.configureAttributes=function configureAttributes(dataObj){_SmartRenderer.prototype.configureAttributes.call(this,dataObj);Object.assign(this.config,dataObj)};_proto.setDimension=function setDimension(dim){this.config.radius=dim.radius};_proto.allocatePosition=function allocatePosition(){var config=this.config;config.path=ribbonGenerator(config.points,config.radius,0);config.ribbonAttrs=config.hovered?config.focussedState:config.unfocussed?config.unfocussedState:config.normalState;config.ribbonAttrs.path=config.path;config.ribbonAttrs["stroke-width"]=(config.showBorder?config.borderThickness:0)||0};_proto.draw=function draw(){var ribbon=this,chartConfig=ribbon.getFromEnv("chart").config,height=chartConfig.canvasHeight,width=chartConfig.canvasWidth,cx=chartConfig.canvasLeft+width/2,cy=chartConfig.canvasTop+height/2,chartWidth=chartConfig.width,chartHeight=chartConfig.height,ribbonRadius=chartConfig.ribbonRadius,config=ribbon.config,angles=config.angles,tooltext=config.showToolTip?getTooltext(config,chartConfig.style.baseFontSize):BLANKSTRING,_polarToCartesian2=polarToCartesian(ribbonRadius,normalizeAngles(deg2Rad(angles[0]))),x1=_polarToCartesian2.x,y1=_polarToCartesian2.y,_polarToCartesian3=polarToCartesian(ribbonRadius,normalizeAngles(deg2Rad(angles[3]))),x2=_polarToCartesian3.x,y2=_polarToCartesian3.y;if(config.dominantNode.length>1&&config.rawColor){config.ribbonAttrs.fill=toRaphaelColor({color:config.rawColor[0]+","+config.rawColor[1],alpha:config.hovered?config.hoverAlpha:config.unfocussed?config.unfocussedAlpha:config.alpha,x1:(x1+cx)/chartWidth,y1:(y1+cy)/chartHeight,x2:(x2+cx)/chartWidth,y2:(y2+cy)/chartHeight});config.ribbonAttrs.stroke=toRaphaelColor({color:config.rawColor[0]+","+config.rawColor[1],alpha:config.hovered?config.hoveredAlpha:config.unfocussed?config.unfocussedAlpha:config.borderAlpha,x1:(x1+cx)/chartWidth,y1:(y1+cy)/chartHeight,x2:(x2+cx)/chartWidth,y2:(y2+cy)/chartHeight})}ribbon.addGraphicalElement({el:"path",label:"ribbon",tooltext:tooltext,attr:config.ribbonAttrs,container:{id:"link-container",isParent:true},component:ribbon})};_proto.getName=function getName(){return"ribbon"};_proto.getType=function getType(){return"dataset"};return Ribbon}(SmartRenderer);export default Ribbon;