import _extends from"@babel/runtime/helpers/extends";import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import{SmartRenderer}from"@fusioncharts/core/src/component-interface";import{sankeyRibbon}from"./sankey-ribbon";import{parseColor,isIpad}from"@fusioncharts/core/src/lib";var CUSTOM="custom",UNIFORM="uniform",SMALLSQUARE="&#9632;",MEDIUMSQUARE="&#x25FC;",getTooltext=function getTooltext(config){var uniChar=isIpad?SMALLSQUARE:MEDIUMSQUARE;return"<div style='padding: 2px; vertical-align: middle;'>\n        <span style='color: "+parseColor(config.sourceFill)+";'>"+uniChar+"&nbsp;</span>"+config.props.source.label+"\n        &rarr;\n        <span style='color: "+parseColor(config.targetFill)+"'>"+uniChar+"&nbsp;</span>"+config.props.target.label+"\n        &nbsp;\n        "+config.value+"\n      </div>"};var SankeyLink=function(_SmartRenderer){_inheritsLoose(SankeyLink,_SmartRenderer);function SankeyLink(){return _SmartRenderer.apply(this,arguments)||this}var _proto=SankeyLink.prototype;_proto.getType=function getType(){return"link"};_proto.getName=function getName(){return"sankey-link"};_proto.configureAttributes=function configureAttributes(inputConfig){if(inputConfig===void 0){inputConfig={}}Object.assign(this.config,inputConfig)};_proto.allocatePosition=function allocatePosition(){var link=this,linkConfig=link.config,mode=linkConfig.mode,style=linkConfig.style,props=linkConfig.props,linkPadding=linkConfig.linkPadding,linkType=linkConfig.linkType,curvature=linkConfig.curvature,_link$getFromEnv=link.getFromEnv("chartConfig"),orientation=_link$getFromEnv.orientation,linkCosmetics=style.link[mode],pathStr,sourcePoint={x:props.x0,y:props.y0,width:props.linkWidth},source=props.source,target=props.target,sourceNodeLayer=source.props.layer,targetNodeLayer=target.props.layer,sourceNodeLen,targetNodeLen,targetPoint={x:props.x1,y:props.y1,width:props.linkWidth},columnGap=link.getLinkedParent().config.columnGap;sourceNodeLen=Math.max(orientation==="vertical"?source.props.x1-source.props.x0:source.props.y1-source.props.y0,0);targetNodeLen=Math.max(orientation==="vertical"?source.props.x1-source.props.x0:source.props.y1-source.props.y0,0);if(linkType!==CUSTOM&&linkType!==UNIFORM){if(props.linkWidth>columnGap*Math.abs(targetNodeLayer-sourceNodeLayer)/3||sourcePoint.width>.7*sourceNodeLen||targetPoint.width>.7*targetNodeLen){linkType=CUSTOM}else{linkType=UNIFORM}}pathStr=sankeyRibbon(sourcePoint,targetPoint,{orientation:orientation,padding:linkPadding,curvature:curvature,linkType:linkType});linkConfig.linkAttr=_extends({path:pathStr,"stroke-width":linkType===UNIFORM?props.linkWidth:"none"},linkCosmetics);if(linkType===CUSTOM){linkConfig.linkAttr.fill=linkConfig.linkAttr.stroke;linkConfig.linkAttr.stroke="none"}};_proto.draw=function draw(){var link=this,linkConfig=link.config,id=linkConfig.id,linkAttr=linkConfig.linkAttr;link.addGraphicalElement({el:"path",attr:linkAttr,container:{id:"sankey-link-group",label:"linkGroup",isParent:true},tooltext:getTooltext(link.config),component:link,id:id,label:"sankey-link"})};return SankeyLink}(SmartRenderer);export default SankeyLink;