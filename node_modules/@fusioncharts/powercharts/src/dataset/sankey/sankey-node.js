import _extends from"@babel/runtime/helpers/extends";import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import{SmartRenderer}from"@fusioncharts/core/src/component-interface";import{parseColor,getSuggestiveRotation,isIpad}from"@fusioncharts/core/src/lib";var START="start",END="end",INSIDE="inside",MIDDLE="middle",defaultTransform="t0,0",SMALLSQUARE="&#9632;",MEDIUMSQUARE="&#x25FC;",getTooltext=function getTooltext(config){var uniChar=isIpad?SMALLSQUARE:MEDIUMSQUARE;return"<div style='padding: 2px; vertical-align: middle;'>\n        <span style='color: "+parseColor(config.rawCosmetics.fill)+";'>"+uniChar+"&nbsp;</span>"+config.label+"\n        &nbsp;\n        &nbsp;\n        "+config.value+"\n      </div>"},BLANK="",SPACE=" ";var SankeyNode=function(_SmartRenderer){_inheritsLoose(SankeyNode,_SmartRenderer);function SankeyNode(){return _SmartRenderer.apply(this,arguments)||this}var _proto=SankeyNode.prototype;_proto.getType=function getType(){return"node"};_proto.getName=function getName(){return"sankey-node"};_proto.configureAttributes=function configureAttributes(inputConfig){if(inputConfig===void 0){inputConfig={}}var nodeConfig=this.config;Object.assign(nodeConfig,inputConfig)};_proto.allocatePosition=function allocatePosition(){var node=this,_node$config=node.config,props=_node$config.props,style=_node$config.style,mode=_node$config.mode,labelPosition=_node$config.labelPosition,showLabel=_node$config.showLabel,formattedLabel=_node$config.formattedLabel,showValue=_node$config.showValue,value=_node$config.value,rotateLabel=_node$config.rotateLabel,labelPadding=_node$config.labelPadding,nodeCosmetics=style.node[mode],labelCosmetics=style.label[mode],orientation=node.getFromEnv("orientation"),sl=node.getFromEnv("smartLabel"),labelXPos,labelYPos,anchor,labelSepChar=node.getLinkedParent().config.labelSepChar,text=formattedLabel.text+(showValue?labelSepChar+SPACE+value:BLANK);if(!showLabel||!formattedLabel.text){text=showValue?value:BLANK;sl.setStyle(style.label.normal);formattedLabel=sl.getSmartText(text)}node.config.nodeAttr=_extends({x:props.x0,y:props.y0,width:Math.max(0,props.x1-props.x0),height:Math.max(0,props.y1-props.y0)},nodeCosmetics);if(orientation==="horizontal"){if(!rotateLabel){if(labelPosition===START){labelXPos=props.x0-labelPadding;anchor=END}else if(labelPosition===INSIDE){labelXPos=Math.abs(props.x0+props.x1)/2;anchor=MIDDLE}else{labelXPos=props.x1+labelPadding;anchor=START}labelYPos=Math.abs(props.y1+props.y0)/2;node.config.labelAttr=_extends({x:labelXPos,y:labelYPos,text:text,transform:defaultTransform,"text-anchor":anchor},labelCosmetics)}else{if(labelPosition===START){labelXPos=props.x0-labelPadding-formattedLabel.height/2}else if(labelPosition===INSIDE){labelXPos=Math.abs(props.x0+props.x1)/2}else{labelXPos=props.x1+labelPadding+formattedLabel.height/2}labelYPos=Math.abs(props.y1+props.y0)/2;node.config.labelAttr=_extends({x:labelXPos,y:labelYPos,text:text,"text-anchor":MIDDLE,transform:getSuggestiveRotation(-90,labelXPos,labelYPos)},labelCosmetics)}}else{if(!rotateLabel){if(labelPosition===START){labelYPos=props.y0-labelPadding-formattedLabel.height/2}else if(labelPosition===INSIDE){labelYPos=Math.abs(props.y0+props.y1)/2}else{labelYPos=props.y1+labelPadding+formattedLabel.height/2}anchor=MIDDLE;labelXPos=(props.x0+props.x1)/2;node.config.labelAttr=_extends({x:labelXPos,y:labelYPos,text:text,transform:defaultTransform,"text-anchor":anchor},labelCosmetics)}else{if(labelPosition===START){labelYPos=props.y0-labelPadding;anchor=START}else if(labelPosition===INSIDE){labelYPos=Math.abs(props.y0+props.y1)/2;anchor=MIDDLE}else{labelYPos=props.y1+labelPadding;anchor=END}labelXPos=Math.abs(props.x1+props.x0)/2;node.config.labelAttr=_extends({x:labelXPos,y:labelYPos,text:text,"text-anchor":anchor,transform:getSuggestiveRotation(-90,labelXPos,labelYPos)},labelCosmetics)}}};_proto.draw=function draw(){var node=this,_node$config2=node.config,id=_node$config2.id,labelAttr=_node$config2.labelAttr,nodeAttr=_node$config2.nodeAttr,textOutline=_node$config2.textOutline,tooltext=getTooltext(node.config);node.addGraphicalElement({el:"rect",attr:nodeAttr,container:{id:"sankey-node-group",label:"nodeGroup",isParent:true},tooltext:tooltext,component:node,id:id,label:"node-rect"});labelAttr.text&&node.addGraphicalElement({el:"text",attr:labelAttr,container:{id:"sankey-node-label-group",label:"nodeLabelGroup",isParent:true},tooltext:tooltext,component:node,id:id,css:{},outlineText:textOutline,label:"node-label"})};return SankeyNode}(SmartRenderer);export default SankeyNode;